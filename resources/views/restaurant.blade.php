<x-front-layout>
<div class="py-1">
        
<div class="flex justify-center items-center mt-4 mb-4 border-b-2">
        <div class="flex gap-1  w-1/2 mb-4">
            <div class="py-2 px-3  bg-red-600 text-white rounded-md flex justify-center items-center transition ease-in-out delay-200  hover:bg-green-800 border-r-2 border-b-2 border-black bg-red-600 rounded-lg ">
                <div class="pe-2">

                <svg fill="#fff" width="40px" height="40px" viewBox="0 -2.89 122.88 122.88" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  style="enable-background:new 0 0 122.88 117.09" xml:space="preserve">

<style type="text/css">.st0{fill-rule:evenodd;clip-rule:evenodd;}</style>

<g>

<path class="st0" d="M36.82,107.86L35.65,78.4l13.25-0.53c5.66,0.78,11.39,3.61,17.15,6.92l10.29-0.41c4.67,0.1,7.3,4.72,2.89,8 c-3.5,2.79-8.27,2.83-13.17,2.58c-3.37-0.03-3.34,4.5,0.17,4.37c1.22,0.05,2.54-0.29,3.69-0.34c6.09-0.25,11.06-1.61,13.94-6.55 l1.4-3.66l15.01-8.2c7.56-2.83,12.65,4.3,7.23,10.1c-10.77,8.51-21.2,16.27-32.62,22.09c-8.24,5.47-16.7,5.64-25.34,1.01 L36.82,107.86L36.82,107.86z M29.74,62.97h91.9c0.68,0,1.24,0.57,1.24,1.24v5.41c0,0.67-0.56,1.24-1.24,1.24h-91.9 c-0.68,0-1.24-0.56-1.24-1.24v-5.41C28.5,63.53,29.06,62.97,29.74,62.97L29.74,62.97z M79.26,11.23 c25.16,2.01,46.35,23.16,43.22,48.06l-93.57,0C25.82,34.23,47.09,13.05,72.43,11.2V7.14l-4,0c-0.7,0-1.28-0.58-1.28-1.28V1.28 c0-0.7,0.57-1.28,1.28-1.28h14.72c0.7,0,1.28,0.58,1.28,1.28v4.58c0,0.7-0.58,1.28-1.28,1.28h-3.89L79.26,11.23L79.26,11.23 L79.26,11.23z M0,77.39l31.55-1.66l1.4,35.25L1.4,112.63L0,77.39L0,77.39z"/>

</g>

</svg>

                </div>
                <div><span> {{ $restaurant->name }} </span> <strong>Restaurant Name</strong> </div>
            </div>
            <div class="py-2 px-3 bg-green-800 text-white rounded-md flex items-center transition all delay-200 hover:bg-blue-600 hover:text-white border-r-2 border-b-2 border-black rounded-lg">
            <div class="pe-2">

<?xml version="1.0" encoding="utf-8"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="40px" height="40px" viewBox="0 0 1024 1024" fill="#fff" class="icon"  version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M512 1012.8c-253.6 0-511.2-54.4-511.2-158.4 0-92.8 198.4-131.2 283.2-143.2h3.2c12 0 22.4 8.8 24 20.8 0.8 6.4-0.8 12.8-4.8 17.6-4 4.8-9.6 8.8-16 9.6-176.8 25.6-242.4 72-242.4 96 0 44.8 180.8 110.4 463.2 110.4s463.2-65.6 463.2-110.4c0-24-66.4-70.4-244.8-96-6.4-0.8-12-4-16-9.6-4-4.8-5.6-11.2-4.8-17.6 1.6-12 12-20.8 24-20.8h3.2c85.6 12 285.6 50.4 285.6 143.2 0.8 103.2-256 158.4-509.6 158.4z m-16.8-169.6c-12-11.2-288.8-272.8-288.8-529.6 0-168 136.8-304.8 304.8-304.8S816 145.6 816 313.6c0 249.6-276.8 517.6-288.8 528.8l-16 16-16-15.2zM512 56.8c-141.6 0-256.8 115.2-256.8 256.8 0 200.8 196 416 256.8 477.6 61.6-63.2 257.6-282.4 257.6-477.6C768.8 172.8 653.6 56.8 512 56.8z m0 392.8c-80 0-144.8-64.8-144.8-144.8S432 160 512 160c80 0 144.8 64.8 144.8 144.8 0 80-64.8 144.8-144.8 144.8zM512 208c-53.6 0-96.8 43.2-96.8 96.8S458.4 401.6 512 401.6c53.6 0 96.8-43.2 96.8-96.8S564.8 208 512 208z" fill="" /></svg>
                            </div>
                <div>
                    <span>{{ $restaurant->address }}</span> <strong>Address</strong> 
                </div>
            </div>
            <div class="py-2 px-3 bg-green-800 text-white rounded-md flex items-center transition all delay-200 hover:bg-blue-600 hover:text-white border-r-2 border-b-2 border-black  rounded-lg"> 
                <div class="pe-2">

<?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="40px" height="40px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.13641 12.764L8.15456 9.08664C8.46255 8.69065 8.61655 8.49264 8.69726 8.27058C8.76867 8.07409 8.79821 7.86484 8.784 7.65625C8.76793 7.42053 8.67477 7.18763 8.48846 6.72184L7.77776 4.9451C7.50204 4.25579 7.36417 3.91113 7.12635 3.68522C6.91678 3.48615 6.65417 3.35188 6.37009 3.29854C6.0477 3.238 5.68758 3.32804 4.96733 3.5081L3 4C3 14 9.99969 21 20 21L20.4916 19.0324C20.6717 18.3121 20.7617 17.952 20.7012 17.6296C20.6478 17.3456 20.5136 17.0829 20.3145 16.8734C20.0886 16.6355 19.7439 16.4977 19.0546 16.222L17.4691 15.5877C16.9377 15.3752 16.672 15.2689 16.4071 15.2608C16.1729 15.2536 15.9404 15.3013 15.728 15.4001C15.4877 15.512 15.2854 15.7143 14.8807 16.119L11.8274 19.1733M12.9997 7C13.9765 7.19057 14.8741 7.66826 15.5778 8.37194C16.2815 9.07561 16.7592 9.97326 16.9497 10.95M12.9997 3C15.029 3.22544 16.9213 4.13417 18.366 5.57701C19.8106 7.01984 20.7217 8.91101 20.9497 10.94" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
                </div>
                <div class="flex flex-col"><span>{{ $restaurant->phone }}</span> <strong>Phone</strong></div>
            </div>

        </div>
       
       
    </div>


        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 grid grid-cols-3 gap-4" x-data="shoppingCart()">
            <div class="bg-white overflow-hidden sm:rounded-lg col-start-1 col-span-2">
                
          

               <template x-for="(menuItem, index) in menuItems" :key="menuItem.id">
                    <div class="flex bg-white gap-1 mb-1 px-4 py-3 border-2 border-gray-100">
                        <div class="py-2 px-3 bg-white text-black rounded-md flex flex-col border-r border-b border-gray-500 flex-none w-64"><strong>


<?xml version="1.0" encoding="utf-8"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="30px" height="30px" viewBox="0 0 1024 1024" class="icon"  version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M774.8 327.8c-50.6-4.8-97.3 4.3-131 22.7 15.9 20.3 26.1 52.1 26.1 87.9 0 29.2-6.8 55.7-17.9 75.5 28.3 16.9 64.5 28.8 104.6 32.6 96.7 9.2 179.2-32.4 184.2-92.8s-69.3-116.7-166-125.9z" fill="#FFB89A" /><path d="M67.2 494l1 31c2.2 67.7 26.2 133.6 69.6 190.4 41.6 54.5 99.6 99.2 167.9 129.3 15.2 6.7 32.9-0.2 39.5-15.4 6.7-15.2-0.2-32.9-15.4-39.5-59-26-108.9-64.3-144.4-110.8-29-38-47.5-80.7-54.4-125h762.6c-7 44.8-25.8 87.9-55.4 126.3-36.1 46.8-86.8 85.2-146.8 110.9-15.2 6.5-22.2 24.2-15.7 39.4 4.9 11.4 15.9 18.2 27.6 18.2 4 0 8-0.8 11.8-2.4 144.5-62.2 237-185.3 241.3-321.4l1-31H67.2z" fill="#45484C" /><path d="M591.9 800.1h-159c-35.2 0-64.1 28.8-64.1 64.1s28.8 64.1 64.1 64.1h159c35.2 0 64.1-28.8 64.1-64.1s-28.9-64.1-64.1-64.1z m0 68.1h-159c-2.1 0-4.1-2-4.1-4.1s2-4.1 4.1-4.1h159c2.1 0 4.1 2 4.1 4.1s-2 4.1-4.1 4.1z" fill="#45484C" /><path d="M498.1 373.5c-9.6-13.5-28.4-16.6-41.9-6.9-13.5 9.6-16.6 28.4-6.9 41.9 10.8 15.1 16.6 33 16.6 51.7 0 16.6 13.4 30 30 30s30-13.4 30-30c0-31.4-9.6-61.4-27.8-86.7zM432.4 321.8c-17.7-7.1-36.3-10.7-55.5-10.7-82.2 0-149 66.8-149 149 0 16.6 13.4 30 30 30s30-13.4 30-30c0-49.1 39.9-89 89-89 11.5 0 22.6 2.1 33.1 6.4 15.4 6.2 32.8-1.3 39-16.7 6.2-15.4-1.2-32.9-16.6-39z" fill="#33CC99" /><path d="M549.4 274.7c-46.7-45.6-107.7-70.8-171.8-70.8-64.1 0-125.1 25.1-171.8 70.8-46.1 45.1-74 106-78.6 171.4-1.2 16.5 11.3 30.9 27.8 32 16.5 1.1 30.9-11.3 32-27.8 3.5-50.8 25.1-97.9 60.7-132.7 35.4-34.6 81.5-53.7 129.9-53.7 48.3 0 94.5 19.1 129.9 53.7 35.6 34.8 57.1 81.9 60.7 132.7 1.1 15.8 14.3 27.9 29.9 27.9 0.7 0 1.4 0 2.1-0.1 16.5-1.2 29-15.5 27.8-32-4.6-65.4-32.5-126.3-78.6-171.4zM895.1 385.9c-11.5-19.4-27.7-36.6-48.1-51.2l53.9-58.3c11.2-12.2 10.5-31.2-1.7-42.4s-31.2-10.5-42.4 1.7l-65 70.4c-5-1.8-10.1-3.5-15.3-5l82.4-159.2c7.6-14.7 1.9-32.8-12.9-40.4-14.7-7.6-32.8-1.9-40.4 12.9l-91.2 176.3c-5.5-0.3-11.1-0.5-16.7-0.5-21.9 0-43.5 2.4-64.3 7.2-16.1 3.7-26.2 19.8-22.5 36 3.7 16.1 19.8 26.2 36 22.5 16.3-3.8 33.4-5.7 50.7-5.7 43.6 0 84.2 11.8 114.3 33.3 27.1 19.3 42 44 42 69.5 0 16.6 13.4 30 30 30s30-13.4 30-30c0-23.5-6.3-46.1-18.8-67.1z" fill="#45484C" /></svg>

                        </strong> <span x-text="menuItem.item_name"></span></div>
                        <div class="py-2 px-3 bg-sky-500 text-white rounded-md flex flex-col border-r-2 border-b-2 border-gray-500 flex-none w-32"><strong>Price</strong> Rs.<span x-text="menuItem.amount"></span></div>

                        <div class="py-2 px-3  rounded-md flex flex-col flex-none w-32">
                        <button type="button" @click="addItem(menuItem.id, menuItem.item_name, menuItem.amount)" >
                        <svg width="30px" height="30px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<circle opacity="0.5" cx="12" cy="12" r="10" stroke="green" stroke-width="1.5"></circle>
<path d="M15 12L12 12M12 12L9 12M12 12L12 9M12 12L12 15" stroke="green" stroke-width="1.5" stroke-linecap="round"></path>
</svg>
</button>
                        </div>
                       
                    </div>
</template>






            </div>

            <!-- right sidebar-->
             <div class="flex flex-col">

             <h3 class="text-2xl mb-2 px-3 py-2 border-b-2 border-gray-300 font-extrabold">Cart</h3>


            <template x-for="(cartItem, index) in cartItems" :key="cartItem.id">
                <div class="flex mb-2 px-3 py-2 border-b-2 border-gray-300 relative">
                    <div x-text="cartItem.name" class="py-2 px-3 bg-blue-500 text-white flex justify-center items-center transition ease-in-out delay-200  hover:bg-green-800 rounded-l-md"></div>
                    <div x-text="'Rs.'+ cartItem.price" class="py-2 px-3 bg-blue-400 text-black flex justify-center items-center transition ease-in-out delay-200  hover:bg-green-800"></div>
                    <div x-text="'Qty.'+ cartItem.quantity" class="py-2 px-3 bg-blue-300 text-black flex justify-center items-center transition ease-in-out delay-200  hover:bg-green-800"></div>
                    <div x-text="'Rs.'+ cartItem.price * cartItem.quantity" class="py-2 px-3 bg-blue-200 text-black flex justify-center items-center transition ease-in-out delay-200  hover:bg-green-800 rounded-r-md"></div>
                    <div @click="removeItem(cartItem.id)" class="absolute top-0 right-0">

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="25px" height="25px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
    
    <title>cross-circle</title>
    <desc>Created with Sketch Beta.</desc>
    <defs>

</defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
        <g id="Icon-Set-Filled" sketch:type="MSLayerGroup" transform="translate(-570.000000, -1089.000000)" fill="#000000">
            <path d="M591.657,1109.24 C592.048,1109.63 592.048,1110.27 591.657,1110.66 C591.267,1111.05 590.633,1111.05 590.242,1110.66 L586.006,1106.42 L581.74,1110.69 C581.346,1111.08 580.708,1111.08 580.314,1110.69 C579.921,1110.29 579.921,1109.65 580.314,1109.26 L584.58,1104.99 L580.344,1100.76 C579.953,1100.37 579.953,1099.73 580.344,1099.34 C580.733,1098.95 581.367,1098.95 581.758,1099.34 L585.994,1103.58 L590.292,1099.28 C590.686,1098.89 591.323,1098.89 591.717,1099.28 C592.11,1099.68 592.11,1100.31 591.717,1100.71 L587.42,1105.01 L591.657,1109.24 L591.657,1109.24 Z M586,1089 C577.163,1089 570,1096.16 570,1105 C570,1113.84 577.163,1121 586,1121 C594.837,1121 602,1113.84 602,1105 C602,1096.16 594.837,1089 586,1089 L586,1089 Z" id="cross-circle" sketch:type="MSShapeGroup">

</path>
        </g>
    </g>
</svg>

                    </div>
                </div>
            </template>

            <div class="total py-2 px-3 mt-3">
                Total: <span x-text="'Rs.'+ totalPrice.toFixed(2)" class="py-2 px-3 bg-green-500 rounded-md"></span>
            </div>

            <div class="checkout-box mt-5 flex">
                <a href="/cart/checkout" class="text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2" x-show="status">Proceed to checkout</a>
            </div>


          



          

             </div>
           

        </div>
    </div>

    <x-slot name="script">
<script>
        function shoppingCart() {
            return {
                restaurant:{{ @$restaurant->id }},
                menuItems: @json($restaurant->menus),
                cartItems: [],
                totalPrice: 0,
                status:false,
                init(){
                    this.getCart();

                    this.$watch('cartItems', (value,oldvalue) => { 
                        console.log(value);
                    });

                },
                async getCart(){
                    try {
                        let response = await fetch("{{ route('cart.index') }}");
                        let data = await response.json();
                        this.cartItems = Array.isArray(data.cartItems) ? data.cartItems : Object.values(data.cartItems);
                        //console.log(this.cartItems);
                        this.calculateTotalPrice();
                        this.isCartEmpty();
                    } catch (error) {
                        console.error('Error fetching cart items:', error);
                    }
                    
                },
                async addItem(id, name, price){
                    try {
                        let response = await fetch("{{ route('cart.add') }}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                            },
                            body: JSON.stringify({ restaurant_id:this.restaurant, id, name, price, quantity: 1 })
                        });
                        let data = await response.json();
                        console.log(data);
                        if(data.matched){
                            alert('yes');
                        }

                        

                        //this.cartItems = Array.isArray(data.cartItems) ? data.cartItems : Object.values(data.cartItems);
                        this.getCart();
                        this.calculateTotalPrice();
                    } catch (error) {
                        console.error('Error adding to cart:', error);
                    }
                    
                },

                async removeItem(id) {
                    this.cartItems = this.cartItems.filter(item => item.id !== id);
                    await fetch("{{ route('cart.remove') }}", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                        },
                        body: JSON.stringify({ id })
                    });
                    this.calculateTotalPrice();
                    this.isCartEmpty();
                },



               /* async checkout(){
                    try {
                        let response = await fetch("{{ route('cart.checkout') }}");
                        let data = await response.json();
                        
                        console.log(data);
                        this.calculateTotalPrice();
                    } catch (error) {
                        console.error('Error fetching cart items:', error);
                    }
                },*/
                isCartEmpty(){
                    if(this.cartItems.length > 0){
                            this.status = true;
                        }else{
                            this.status = false;
                        }
                },
                calculateTotalPrice() {
                    //this.totalPrice = this.totalPrice + 2;
                   
                    //this.totalPrice = this.cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);    
                    this.totalPrice = Array.isArray(this.cartItems)
                    ? this.cartItems.reduce((total, item) => total + (item.price * item.quantity), 0)
                    : 0;       
                }
            };
        }
    </script>
</x-slot>

</x-front-layout>
